{% extends 'base.html' %}

{% block title %}Teilnehmerübersicht{% endblock %}

{% block content %}
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Teilnehmerübersicht</h2>

    <!-- Such- und Sortierfunktion -->
    <div class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
        <form method="get" action="{{ url_for('manage_participants') }}" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
            <!-- Suchfeld -->
            <div class="md:col-span-2">
                <label for="q" class="block text-sm font-medium text-gray-700 mb-1">Teilnehmer suchen</label>
                <input type="text" name="q" id="q" value="{{ request.args.get('q', '') }}" placeholder="Name oder Gruppe..." class="w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <!-- Sortierfeld -->
            <div>
                <label for="sort" class="block text-sm font-medium text-gray-700 mb-1">Sortieren nach</label>
                <div class="flex space-x-2">
                    <select name="sort" id="sort" class="flex-1 rounded-md border-gray-300 shadow-sm p-2">
                        <option value="name_asc" {% if request.args.get('sort') == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                        <option value="name_desc" {% if request.args.get('sort') == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                        <option value="group_asc" {% if request.args.get('sort') == 'group_asc' %}selected{% endif %}>Gruppe (A-Z)</option>
                        <option value="group_desc" {% if request.args.get('sort') == 'group_desc' %}selected{% endif %}>Gruppe (Z-A)</option>
                    </select>
                    <button type="submit" class="py-2 px-6 rounded-md text-white bg-blue-600 hover:bg-blue-700 font-semibold">Anwenden</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Teilnehmerliste -->
    <div class="space-y-4">
        {% for participant in participants %}
        <div class="p-4 border rounded-lg bg-white shadow-sm">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                <div>
                    <h3 class="text-lg font-medium text-gray-800">{{ participant.name }}</h3>
                    <p class="text-sm text-gray-500">Gruppe: {{ participant.group_name }}</p>
                </div>
                <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0 mt-2 sm:mt-0">
                    <a href="{{ url_for('show_data_entry', participant_id=participant.id) }}" class="py-2 px-4 text-sm rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 text-center">Dateneingabe</a>
                    <a href="{{ url_for('show_report', participant_id=participant.id) }}" class="py-2 px-4 text-sm rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 text-center">Bericht anzeigen</a>
                </div>
            </div>
        </div>
        {% else %}
        <p class="text-gray-500 italic">Keine Teilnehmer gefunden, die den Kriterien entsprechen.</p>
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="mt-8 flex justify-center items-center space-x-2">
        {% if pagination.has_prev %}
            <a href="{{ url_for('manage_participants', page=pagination.prev_num, q=request.args.get('q', ''), sort=request.args.get('sort', '')) }}" class="py-2 px-4 rounded-md bg-gray-200 hover:bg-gray-300 text-sm font-medium">‹ Vorherige</a>
        {% endif %}
        
        <span class="text-sm text-gray-700">Seite {{ pagination.page }} von {{ pagination.pages }}</span>
        
        {% if pagination.has_next %}
            <a href="{{ url_for('manage_participants', page=pagination.next_num, q=request.args.get('q', ''), sort=request.args.get('sort', '')) }}" class="py-2 px-4 rounded-md bg-gray-200 hover:bg-gray-300 text-sm font-medium">Nächste ›</a>
        {% endif %}
    </div>
{% endblock %}

